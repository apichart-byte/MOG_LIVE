<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Paper Format for delivery document Reports -->
    <record id="paperformat_dispatch_report" model="report.paperformat">
        <field name="name">Dispatch Report Letter Full Coverage</field>
        <field name="default" eval="False"/>
        <field name="format">Letter</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">0</field>
        <field name="margin_bottom">0</field>
        <field name="margin_left">0</field>
        <field name="margin_right">0</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">96</field>
        <field name="disable_shrinking" eval="True"/>
    </record>
    <template id="dispatch_report_document">
        <t t-call="web.basic_layout">
            <t t-foreach="docs" t-as="o">
                <t t-set="config" t-value="request.env['dispatch.report.config'].sudo().get_default_config()"/>
                <!-- Convert px to mm: 96 DPI = 1px = 0.2646mm -->
                <t t-set="px_to_mm" t-value="0.2646"/>
                
                <div class="page" t-attf-style="width: 216mm; height: 279mm; position: relative; font-family: {{config.font_family or 'Sarabun, sans-serif'}}; font-size: {{config.font_size or 14}}px; page-break-after: always; margin: 0; padding: 0; overflow: visible; box-sizing: border-box;">
                    
                    <style>
                        @font-face {
                            font-family: 'Sarabun';
                            src: url('/buz_inventory_delivery_report/static/fonts/Sarabun-Regular.ttf') format('truetype');
                            font-weight: normal;
                            font-style: normal;
                        }
                        
                        @font-face {
                            font-family: 'Sarabun';
                            src: url('/buz_inventory_delivery_report/static/fonts/Sarabun-Bold.ttf') format('truetype');
                            font-weight: bold;
                            font-style: normal;
                        }
                        
                        @page {
                            size: Letter portrait;
                            margin: 0mm 0mm 0mm 0mm !important;
                            padding: 0mm !important;
                        }
                        
                        html, body {
                            margin: 0 !important;
                            padding: 0 !important;
                            width: 216mm !important;
                            height: 279mm !important;
                            box-sizing: border-box;
                            overflow: visible;
                        }
                        
                        * {
                            box-sizing: border-box;
                        }
                        
                        .page {
                            margin: 0 !important;
                            padding: 0 !important;
                            width: 216mm !important;
                            height: 279mm !important;
                        }
                        
                        body, table, th, td, div, p, span, h1, h2, h3, h4, h5, h6 {
                            font-family: '<t t-esc="config.font_family or 'Sarabun'"/>', sans-serif !important;
                            font-size: <t t-esc="config.font_size or 14"/>px;
                            line-height: <t t-esc="config.line_spacing or 1.2"/>;
                        }
                        
                        .thai-text {
                            font-family: 'Sarabun', sans-serif !important;
                        }
                        
                        .article {
                            page-break-after: always;
                        }
                        
                        /* Full page coverage styles */
                        .page {
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                            }
                            .page {
                                margin: 0;
                                padding: 0;
                                width: 216mm;
                                height: 279mm;
                            }
                        }
                    </style>
                    
                    <!-- Document Number - เลขที่เอกสาร -->
                    <div t-attf-style="position: absolute; top: {{config.doc_number_top * px_to_mm}}mm; left: {{config.doc_number_left * px_to_mm}}mm; white-space: nowrap; word-break: keep-all;" class="thai-text">
                        <span t-field="o.name"/>
                    </div>
                    
                    <!-- Document Date - วันที่ -->
                    <div t-attf-style="position: absolute; top: {{config.doc_date_top * px_to_mm}}mm; left: {{config.doc_date_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.scheduled_date" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/>
                    </div>
                    
                    <!-- SO Number - เลขที่ SO -->
                    <div t-attf-style="position: absolute; top: {{config.so_number_top * px_to_mm}}mm; left: {{config.so_number_left * px_to_mm}}mm; white-space: nowrap; word-break: keep-all;" class="thai-text">
                        <t t-if="o.sale_id">
                            <span t-field="o.sale_id.name"/>
                        </t>
                        <t t-elif="o.origin">
                            <span t-field="o.origin"/>
                        </t>
                    </div>
                    
                    <!-- Customer Name - ชื่อลูกค้า -->
                    <div t-attf-style="position: absolute; top: {{config.customer_name_top * px_to_mm}}mm; left: {{config.customer_name_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.partner_id.name"/>
                    </div>
                    
                    <!-- Customer Address Line 1 - ที่อยู่บรรทัด 1 -->
    <div t-attf-style="position: absolute; top: {{config.customer_address_top * px_to_mm}}mm; left: {{config.customer_address_left * px_to_mm}}mm; max-width: 80mm;" class="thai-text">
        <t t-if="o.partner_id.street">
            <span t-field="o.partner_id.street"/>
            <t t-if="o.partner_id.street2">
                <span> </span><span t-field="o.partner_id.street2"/>
            </t>
        </t>
    </div>
    
    <!-- Customer Address Line 2 - ที่อยู่บรรทัด 2 (อำเภอ จังหวัด รหัสไปรษณีย์) -->
    <div t-attf-style="position: absolute; top: {{config.customer_address_line2_top * px_to_mm}}mm; left: {{config.customer_address_line2_left * px_to_mm}}mm; max-width: 80mm;" class="thai-text">
        <t t-set="address_parts" t-value="[]"/>
        <t t-if="o.partner_id.city" t-set="address_parts" t-value="address_parts + [o.partner_id.city]"/>
        <t t-if="o.partner_id.state_id" t-set="address_parts" t-value="address_parts + [o.partner_id.state_id.name]"/>
        <t t-if="o.partner_id.zip" t-set="address_parts" t-value="address_parts + [o.partner_id.zip]"/>
        <span t-esc="' '.join(address_parts)"/>
    </div>
                    
                    <!-- Customer Phone - เบอร์โทรศัพท์ -->
                    <div t-attf-style="position: absolute; top: {{config.customer_phone_top * px_to_mm}}mm; left: {{config.customer_phone_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.partner_id.phone"/>
                    </div>
                    
                    <!-- Vehicle Type - ประเภทรถ -->
                    <div t-attf-style="position: absolute; top: {{config.vehicle_type_top * px_to_mm}}mm; left: {{config.vehicle_type_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.vehicle_type"/>
                    </div>
                    
                    <!-- Vehicle Plate - ทะเบียนรถ -->
                    <div t-attf-style="position: absolute; top: {{config.vehicle_plate_top * px_to_mm}}mm; left: {{config.vehicle_plate_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.vehicle_plate"/>
                    </div>
                    
                    <!-- Driver Name - ชื่อพนักงานขับรถ -->
                    <div t-attf-style="position: absolute; top: {{config.driver_name_top * px_to_mm}}mm; left: {{config.driver_name_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.driver"/>
                    </div>
                    
                    <!-- Dispatch Location - สถานที่จ่ายสินค้า -->
                    <div t-attf-style="position: absolute; top: {{config.dispatch_location_top * px_to_mm}}mm; left: {{config.dispatch_location_left * px_to_mm}}mm;" class="thai-text">
                        <span t-field="o.dispatch_location"/>
                    </div>
                    
                    <!-- Product Lines - รายการสินค้า -->
                    <div t-attf-style="position: absolute; top: {{config.table_top * px_to_mm}}mm; left: {{config.table_left * px_to_mm}}mm;" class="thai-text">
                        <t t-set="line_index" t-value="0"/>
                        <t t-foreach="o.move_ids" t-as="line">
                            <t t-set="current_top" t-value="line_index * config.line_height * px_to_mm"/>
                            
                            <!-- Line Number - ลำดับ -->
                            <div t-attf-style="position: absolute; top: {{current_top}}mm; left: {{config.col_no_left * px_to_mm}}mm;">
                                <span t-esc="line_index + 1"/>
                            </div>
                            
                            <!-- Product Code - รหัสสินค้า -->
                            <div t-attf-style="position: absolute; top: {{current_top}}mm; left: {{config.col_code_left * px_to_mm}}mm; white-space: nowrap; word-break: keep-all;">
                                <span t-field="line.product_id.default_code"/>
                            </div>
                            
                            <!-- Product Name - ชื่อสินค้า -->
                            <div t-attf-style="position: absolute; top: {{current_top}}mm; left: {{config.col_name_left * px_to_mm}}mm; max-width: 60mm; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <span t-field="line.product_id.name"/>
                            </div>
                            
                            <!-- Quantity - จำนวน -->
                            <div t-attf-style="position: absolute; top: {{current_top}}mm; left: {{config.col_qty_left * px_to_mm}}mm; text-align: right; width: 16mm;">
                                <span t-esc="'{:,.2f}'.format(line.product_uom_qty)"/>
                            </div>
                            
                            <!-- Unit - หน่วย -->
                            <div t-attf-style="position: absolute; top: {{current_top}}mm; left: {{config.col_unit_left * px_to_mm}}mm;">
                                <span t-field="line.product_uom.name"/>
                            </div>
                            
                            <t t-set="line_index" t-value="line_index + 1"/>
                        </t>
                    </div>
                    
                </div>
            </t>
        </t>
    </template>


    <record id="action_distributor_delivery_export" model="ir.actions.report">
        <field name="name">ใบจ่ายสินค้า</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">buz_inventory_delivery_report.dispatch_report_document</field>
        <field name="report_file">buz_inventory_delivery_report.dispatch_report_document</field>
        <field name="print_report_name">'Delivery Report - %s' % object.name</field>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_dispatch_report"/>
    </record>
</odoo>
