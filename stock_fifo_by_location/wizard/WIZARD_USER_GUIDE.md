# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Recalculate Valuation Wizard

## üìç ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Odoo
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π **Inventory > Configuration > Recalculate Valuation**

‡∏´‡∏£‡∏∑‡∏≠

**‡πÄ‡∏°‡∏ô‡∏π hamburger (‚ò∞) > Inventory > Configuration > Recalculate Valuation**

## üéØ ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

Wizard ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Stock Valuation ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å:
- ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î module stock_fifo_by_location
- ‡∏Å‡∏≤‡∏£ import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• stock ‡πÄ‡∏Å‡πà‡∏≤
- Valuation ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
- Products ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á remaining qty ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

## ‚öôÔ∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ

### 1. Warehouses (‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
- **‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏±‡∏á
- **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### 2. Fix NULL Remaining Values
- **‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç negative layers ‡∏ó‡∏µ‡πà‡∏°‡∏µ `remaining_value = NULL` ‡πÄ‡∏õ‡πá‡∏ô `0.0`
- **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£:** ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

### 3. Recalculate Remaining Qty/Value ‚≠ê
- **‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:** ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì `remaining_qty` ‡πÅ‡∏•‡∏∞ `remaining_value` ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ FIFO ‡∏ï‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á
- **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£:** ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠:
  - ‡∏û‡∏ö‡∏ß‡πà‡∏≤ `total_qty ‚â† remaining_qty`
  - Valuation report ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
  - ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• stock

### 4. Fix Value Mismatch
- **‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç products ‡∏ó‡∏µ‡πà `total_qty = 0` ‡πÅ‡∏ï‡πà `total_value ‚â† 0`
- **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£:** ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö products ‡∏°‡∏µ value ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ quantity

## üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏õ‡∏¥‡∏î Wizard
```
Inventory > Configuration > Recalculate Valuation
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Warehouses (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏±‡∏á)
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Operations ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ï‡∏±‡∏ß)
3. ‡∏≠‡πà‡∏≤‡∏ô Information tab ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
1. ‡∏Ñ‡∏•‡∏¥‡∏Å **"Start Recalculation"**
2. ‡∏£‡∏≠‡∏à‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô **"Done"**
3. ‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á:
- ‚úÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô layers ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç NULL values
- ‚úÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô products ‡πÅ‡∏•‡∏∞ layers ‡∏ó‡∏µ‡πà recalculate
- ‚úÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô products ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç value mismatch
- ‚úÖ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

## üïê ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•

| ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Products | ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ß‡∏•‡∏≤ |
|----------------|------------|
| < 500          | 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ  |
| 500 - 2,000    | 1-3 ‡∏ô‡∏≤‡∏ó‡∏µ   |
| 2,000 - 5,000  | 3-10 ‡∏ô‡∏≤‡∏ó‡∏µ  |
| > 5,000        | 10+ ‡∏ô‡∏≤‡∏ó‡∏µ   |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô layers ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á server

## ‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô wizard ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‚ùå
```sql
Product: RS00006110
- total_qty: 0.0
- total_value: 142.42 ‚ùå
- remaining_qty: 19.0 ‚ùå
- remaining_value: 2045.10
```

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‚úÖ
```sql
Product: RS00006110
- total_qty: 0.0
- total_value: 0.0 ‚úÖ
- remaining_qty: 0.0 ‚úÖ
- remaining_value: 0.0 ‚úÖ
```

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

### ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á (idempotent)
- ‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- Commit ‡∏ó‡∏µ‡∏•‡∏∞ 100 products
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠

### ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á
- **Backup database** ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö production
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà
- ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (off-peak hours)

## üîç ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ SQL Query
```sql
-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö value mismatch
SELECT COUNT(*) FROM (
    SELECT pp.id
    FROM stock_valuation_layer svl
    JOIN product_product pp ON pp.id = svl.product_id
    GROUP BY pp.id
    HAVING ABS(SUM(svl.quantity)) < 0.01
       AND ABS(SUM(svl.value)) > 0.01
) sub;
-- Expected: 0
```

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏î‡∏π‡∏à‡∏≤‡∏Å Wizard Result
- Wizard ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ "Value mismatch" ‡πÅ‡∏•‡∏∞ "Remaining mismatch" = 0

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Use Cases

### Case 1: ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î Module
```
‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå: ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î stock_fifo_by_location ‡∏à‡∏≤‡∏Å v17.0.1.1.3 ‚Üí v17.0.1.1.4
‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Existing negative layers ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô _run_fifo() ‡πÉ‡∏´‡∏°‡πà
‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏£‡∏±‡∏ô wizard ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏¥‡∏î "Recalculate Remaining Qty/Value"
```

### Case 2: Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
```
‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå: Import valuation layers ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤
‡∏õ‡∏±‡∏ç‡∏´‡∏≤: remaining_qty ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏î
‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏£‡∏±‡∏ô wizard ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
```

### Case 3: ‡∏û‡∏ö Products ‡πÅ‡∏™‡∏î‡∏á Value ‡∏ú‡∏¥‡∏î
```
‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå: Product ‡∏°‡∏µ qty=0 ‡πÅ‡∏ï‡πà‡πÅ‡∏™‡∏î‡∏á value=142.42
‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Negative ‡πÅ‡∏•‡∏∞ Positive layers ‡πÑ‡∏°‡πà balance
‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏£‡∏±‡∏ô wizard ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏¥‡∏î "Fix Value Mismatch"
```

## üÜò Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Wizard ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user ‡∏°‡∏µ permission `Stock Manager`
2. Refresh browser (Ctrl+F5)
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ module ‡∏ñ‡∏π‡∏Å install ‡πÅ‡∏•‡πâ‡∏ß

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Processing ‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ warehouses ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡πÅ‡∏ó‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏±‡∏á)
2. ‡∏£‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö server resources (CPU, Memory)

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Error during processing
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏î‡∏π log ‡∏ó‡∏µ‡πà `/var/log/odoo/instance1.log`
2. ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
3. Restore database ‡∏à‡∏≤‡∏Å backup

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Support

‡∏´‡∏≤‡∏Å‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:
- GitHub: https://github.com/apcball/apcball
- Email: support@example.com
- Line: @example

---

**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** v17.0.1.1.4  
**‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 2025-11-28  
**‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:** APC Ball
