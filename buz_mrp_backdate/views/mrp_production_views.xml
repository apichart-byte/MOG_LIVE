<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit MRP Production Form View -->
    <record id="view_mrp_production_form_inherit_backdate" model="ir.ui.view">
        <field name="name">mrp.production.form.backdate</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
        <field name="arch" type="xml">
            <!-- Add button in header -->
            <xpath expr="//header" position="inside">
                <button name="action_open_backdate_wizard" 
                        type="object" 
                        string="Set Backdate" 
                        class="btn-primary"
                        groups="buz_mrp_backdate.group_mrp_backdate"
                        invisible="state != 'done'"/>
            </xpath>
            
            <!-- Add backdate fields in form -->
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="backdate" 
                       string="Backdate"
                       groups="buz_mrp_backdate.group_mrp_backdate"
                       readonly="1"
                       invisible="not backdate"/>
                <field name="backdate_remark" 
                       string="Remark"
                       groups="buz_mrp_backdate.group_mrp_backdate"
                       readonly="1"
                       invisible="not backdate_remark"/>
            </xpath>
        </field>
    </record>

    <!-- Add backdate fields to tree view -->
    <record id="view_mrp_production_tree_inherit_backdate" model="ir.ui.view">
        <field name="name">mrp.production.tree.backdate</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="after">
                <field name="backdate" optional="hide" groups="buz_mrp_backdate.group_mrp_backdate"/>
            </xpath>
        </field>
    </record>

    <!-- Stock Move Form View - Add backdate remark -->
    <record id="view_stock_move_form_inherit_backdate" model="ir.ui.view">
        <field name="name">stock.move.form.backdate</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date']" position="after">
                <field name="backdate_remark" 
                       readonly="1"
                       invisible="not backdate_remark"/>
            </xpath>
        </field>
    </record>

    <!-- Stock Valuation Layer Form View - Add backdate remark -->
    <record id="view_stock_valuation_layer_form_inherit_backdate" model="ir.ui.view">
        <field name="name">stock.valuation.layer.form.backdate</field>
        <field name="model">stock.valuation.layer</field>
        <field name="inherit_id" ref="stock_account.stock_valuation_layer_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='create_date']" position="after">
                <field name="backdate_remark" 
                       readonly="1"
                       invisible="not backdate_remark"/>
            </xpath>
        </field>
    </record>

    <!-- Account Move Form View - Add backdate remark -->
    <record id="view_account_move_form_inherit_backdate" model="ir.ui.view">
        <field name="name">account.move.form.backdate</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='narration']" position="after">
                <field name="mrp_backdate_remark" 
                       readonly="1"
                       invisible="not mrp_backdate_remark"/>
            </xpath>
        </field>
    </record>
</odoo>
