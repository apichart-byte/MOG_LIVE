
<odoo>
  <record id="view_buz_account_receipt_tree" model="ir.ui.view">
    <field name="name">buz.account.receipt.tree</field>
    <field name="model">account.receipt</field>
    <field name="arch" type="xml">
      <tree string="Receipts" create="true" edit="false" decoration-success="state=='posted'" decoration-muted="state=='cancel'" decoration-info="state=='draft'">
        <field name="name" string="Receipt Number" widget="text_tag"/>
        <field name="date" string="Date"/>
        <field name="partner_id" string="Customer"/>
        <field name="amount_total" string="Total Amount" sum="Total Amount" widget="monetary"/>
        <field name="state" string="Status" widget="badge"/>
      </tree>
    </field>
  </record>

  <record id="view_buz_account_receipt_search" model="ir.ui.view">
    <field name="name">buz.account.receipt.search</field>
    <field name="model">account.receipt</field>
    <field name="arch" type="xml">
      <search string="Receipts">
        <field name="name" string="Receipt Number"/>
        <field name="partner_id" string="Customer"/>
        <field name="date" string="Date"/>
        <field name="state" string="Status"/>
        <field name="amount_total" string="Total Amount"/>
        
        <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]"/>
        <filter name="posted" string="Posted" domain="[('state', '=', 'posted')]"/>
        <separator/>
        <filter name="positive_amount" string="Amount > 0" domain="[('amount_total', '>', 0)]"/>
        <filter name="has_payments" string="Has Payments" domain="[('payment_count', '>', 0)]"/>
        <separator/>
        <filter name="this_month" string="This Month" domain="[('date', '>=', (context_today() - relativedelta(day=1)).strftime('%Y-%m-%d')), ('date', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>
        
        <group expand="0" string="Group By">
          <filter name="group_by_partner" string="Customer" domain="[]" context="{'group_by': 'partner_id'}"/>
          <filter name="group_by_date" string="Date" domain="[]" context="{'group_by': 'date'}"/>
          <filter name="group_by_state" string="Status" domain="[]" context="{'group_by': 'state'}"/>
        </group>
      </search>
    </field>
  </record>

  <record id="view_buz_account_receipt_form" model="ir.ui.view">
    <field name="name">buz.account.receipt.form</field>
    <field name="model">account.receipt</field>
    <field name="arch" type="xml">
      <form string="Receipt" create="false">
        <header>
          <button name="action_reset_to_draft" string="Reset to Draft" type="object"
                  invisible="state not in ['posted', 'cancel']" class="btn btn-secondary"/>
          <button name="action_post" string="Confirm" type="object" invisible="state != 'draft'" class="btn btn-success"/>
          <button name="action_register_batch_payment" string="Register Batch Payment" type="object" 
                  invisible="state != 'posted'" class="btn btn-primary"/>
          <button name="action_print_receipt" string="Print Receipt" type="object" invisible="state not in ['draft', 'posted']" class="btn btn-primary"/>
          <button name="%(buz_account_receipt.action_report_account_receipt_preprint)d" string="Print Receipt Preprint" type="action" invisible="state not in ['draft', 'posted']" class="btn btn-info"/>
          <field name="state" widget="statusbar" statusbar_visible="draft,posted,cancel"/>
        </header>
        <sheet>
          <div class="oe_title" style="display: flex; align-items: center;">
            <label for="name" class="o_form_label" style="font-size: 16px; font-weight: bold; margin-right: 10px;"/>
            <h1>
              <field name="name" readonly="1" class="oe_inline" style="font-size: 20px; font-weight: bold; color: #01040eff;"/>
            </h1>
          </div>
        
          <group col="4" colspan="4" style="margin-top: 10px; padding: 10px; border-radius: 5px; background-color: #f8f9fa;">
            <group name="basic_info" string="Receipt Details" colspan="2">
              <field name="date" widget="date" string="Receipt Date"/>
              <field name="partner_id" options="{'no_create': True}" readonly="state != 'draft'" string="Customer"/>
              <field name="company_id" readonly="1" string="Company"/>
              <field name="currency_id" readonly="1" string="Currency"/>
              <!-- used_move_ids is required in the view because the tree inline domain references parent.used_move_ids -->
              <field name="used_move_ids" invisible="1"/>
            </group>
            
            <group name="amount_info" string="Amounts" col="2">
              <field name="amount_total" readonly="1" nolabel="1" invisible="state == 'draft'"
                     widget="monetary" options="{'field_digits': True, 'currency_field': 'currency_id'}"/>
              <field name="amount_invoice_total" readonly="1" nolabel="1" invisible="state == 'draft'"
                     widget="monetary" options="{'field_digits': True, 'currency_field': 'currency_id'}"/>
            </group>
            
            <group name="payment_info" string="Payment Information" colspan="2" invisible="state == 'draft'">
              <field name="payment_state" readonly="1" string="Payment Status" widget="badge" decoration-info="payment_state=='not_paid'" decoration-warning="payment_state=='partial'" decoration-success="payment_state=='paid'" decoration-danger="payment_state=='overpaid'"/>
              <field name="amount_paid" readonly="1" string="Paid Amount" widget="monetary" options="{'field_digits': True, 'currency_field': 'currency_id'}"/>
              <field name="amount_residual" readonly="1" string="Residual Amount" widget="monetary" options="{'field_digits': True, 'currency_field': 'currency_id'}"/>
            </group>
          </group>
          
          <div class="oe_button_box" name="button_box" style="margin: 5px 0;">
            <button name="action_view_payments" type="object" class="oe_stat_button" icon="fa-money" style="padding: 10px;">
              <field string="Payments" name="payment_count" widget="statinfo" style="font-size: 14px;"/>
            </button>
          </div>
          
          <group col="4" colspan="4" style="margin-top: 10px;">
            <group name="delivery_info" string="Delivery Information" colspan="2">
              <field name="delivery_partner_id" readonly="state != 'draft'" string="Delivery Partner"/>
            </group>
            <group name="notes" string="Notes" colspan="2">
              <field name="note" readonly="state != 'draft'" placeholder="Enter any notes about this receipt..."/>
            </group>
          </group>

          <notebook>
            <page string="Invoice Lines" name="lines">
              <field name="line_ids">
                <tree editable="bottom">
                  <field name="move_id" domain="[('move_type', 'in', ['out_invoice', 'out_refund']), ('state', '=', 'posted'), ('partner_id', '=', parent.partner_id), ('id', 'not in', parent.used_move_ids)]" string="Invoice"/>
                  <field name="move_name" readonly="1" string="Invoice Number"/>
                  <field name="invoice_date" readonly="1" string="Invoice Date"/>
                  <field name="amount_total_signed" readonly="1" string="Invoice Total (Signed)" widget="monetary" optional="hide"/>
                  <field name="amount_residual_signed" readonly="1" string="Residual (Signed)" widget="monetary" optional="hide"/>
                  <field name="amount_paid_to_date" readonly="1" string="Paid to Date" widget="monetary"/>
                  <field name="amount_to_collect" string="To Collect (This Receipt)" widget="monetary"/>
                  <button name="action_register_payment_line" type="object" string="Register Payment" icon="fa-credit-card"/>
                  <field name="currency_id" invisible="1"/>
                </tree>
              </field>
            </page>
            
            <!-- Additional Information page removed as requested -->
          </notebook>
        </sheet>
        <!-- Chatter -->
        <div class="oe_chatter">
          <field name="message_follower_ids" groups="base.group_user"/>
          <field name="activity_ids"/>
          <field name="message_ids"/>
        </div>
      </form>
    </field>
  </record>



  <!-- Server Action for Creating Receipt Voucher from Receipts -->
  <record id="action_create_receipt_voucher_from_receipts" model="ir.actions.server">
    <field name="name">Create Receipt Voucher</field>
    <field name="model_id" ref="model_account_receipt"/>
    <field name="binding_model_id" ref="model_account_receipt"/>
    <field name="state">code</field>
    <field name="code">
records = env['account.receipt'].browse(env.context.get('active_ids', []))
action = records.action_create_receipt_voucher_from_receipts()
    </field>
  </record>

  <record id="action_buz_account_receipt" model="ir.actions.act_window">
    <field name="name">Receipts</field>
    <field name="res_model">account.receipt</field>
    <field name="view_mode">tree,form</field>
    <field name="search_view_id" ref="view_buz_account_receipt_search"/>
  </record>

  <menuitem id="menu_buz_account_receipt_history" name="Receipts"
            parent="account.menu_finance_receivables"
            action="action_buz_account_receipt" sequence="11"/>
</odoo>
